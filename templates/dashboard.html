<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Knowledge Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%);
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        .tool-badge {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .hot-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .briefing-content {
            white-space: pre-wrap;
        }
        .loading {
            display: none;
        }
        .loading.active {
            display: flex;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 backdrop-blur-lg bg-indigo-950/80 border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üß†</span>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                        AI Knowledge Dashboard
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 transition font-medium text-sm">
                        Dashboard
                    </a>
                    <a href="/browse" class="px-4 py-2 rounded-lg hover:bg-white/10 transition font-medium text-sm">
                        Browse Emails
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Stats Overview -->
        <section class="mb-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="stat-card rounded-xl p-5">
                    <div class="text-3xl font-bold text-indigo-300">{{ stats.total_emails }}</div>
                    <div class="text-sm text-gray-400 mt-1">Total Emails</div>
                </div>
                <div class="stat-card rounded-xl p-5">
                    <div class="text-3xl font-bold text-purple-300">{{ stats.total_links }}</div>
                    <div class="text-sm text-gray-400 mt-1">Links Collected</div>
                </div>
                <div class="stat-card rounded-xl p-5">
                    <div class="text-3xl font-bold text-pink-300">{{ stats.total_categories }}</div>
                    <div class="text-sm text-gray-400 mt-1">Categories</div>
                </div>
                <div class="stat-card rounded-xl p-5">
                    <div class="text-3xl font-bold text-blue-300">{{ stats.unique_domains }}</div>
                    <div class="text-sm text-gray-400 mt-1">Unique Sources</div>
                </div>
            </div>
            <p class="text-gray-400 text-sm mt-3">
                üìÖ Data from {{ stats.date_range.start }} to {{ stats.date_range.end }} ‚Ä¢ Last updated: {{ last_updated }}
            </p>
        </section>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Briefing + Trends -->
            <div class="lg:col-span-2 space-y-6">
                <!-- AI Briefing Card -->
                <div class="card rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold flex items-center">
                            <span class="mr-2">üìä</span> AI Briefing
                        </h2>
                        <button id="generate-briefing" 
                                class="px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 transition text-sm font-medium">
                            Generate Briefing
                        </button>
                    </div>
                    <div id="briefing-loading" class="loading items-center justify-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-400"></div>
                        <span class="ml-3 text-gray-400">Generating insights...</span>
                    </div>
                    <div id="briefing-content" class="prose prose-invert max-w-none">
                        <p class="text-gray-400">Click "Generate Briefing" to get an AI-powered summary of recent activity.</p>
                    </div>
                </div>

                <!-- Trend Chart -->
                <div class="card rounded-2xl p-6">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="mr-2">üìà</span> Topic Trends (Last 30 Days)
                    </h2>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Categories Grid -->
                <div class="card rounded-2xl p-6">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="mr-2">üìÅ</span> Categories
                    </h2>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                        {% for cat in categories %}
                        <a href="/browse#{{ cat.category | replace(' ', '-') }}" 
                           class="flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition">
                            <span class="text-sm font-medium truncate">{{ cat.category }}</span>
                            <span class="text-xs bg-indigo-600/50 px-2 py-1 rounded-full ml-2">{{ cat.count }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Right Column: Hot Topics + Tools -->
            <div class="space-y-6">
                <!-- What's Hot -->
                <div class="card rounded-2xl p-6">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="mr-2 hot-badge">üî•</span> What's Hot This Week
                    </h2>
                    <div class="space-y-3">
                        {% for topic in hot_topics %}
                        <div class="flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-orange-600/20 to-red-600/20 border border-orange-500/30">
                            <span class="font-medium">{{ topic.category }}</span>
                            <span class="text-orange-400 font-bold">{{ topic.count }} new</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Top Tools -->
                <div class="card rounded-2xl p-6">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="mr-2">üõ†Ô∏è</span> Top Tools Discussed
                    </h2>
                    <div class="space-y-3">
                        {% for tool in top_tools %}
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="tool-badge text-xs px-2 py-1 rounded mr-3">{{ tool.category }}</span>
                                <span class="font-medium">{{ tool.name }}</span>
                            </div>
                            <span class="text-gray-400 text-sm">{{ tool.mentions }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    <a href="/api/tools" class="block mt-4 text-center text-sm text-indigo-400 hover:text-indigo-300 transition">
                        View all tools ‚Üí
                    </a>
                </div>

                <!-- Trending Topics -->
                <div class="card rounded-2xl p-6">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="mr-2">üöÄ</span> Trending Topics
                    </h2>
                    <div id="trending-topics" class="space-y-2">
                        <p class="text-gray-400 text-sm">Loading...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="max-w-7xl mx-auto px-4 py-8 mt-8 border-t border-white/10">
        <p class="text-center text-gray-500 text-sm">
            AI Knowledge Base Dashboard ‚Ä¢ Built for learning and discovery
        </p>
    </footer>

    <script>
        // Fetch and render trend chart
        async function loadTrendChart() {
            try {
                const response = await fetch('/api/timeline?days=30');
                const data = await response.json();
                
                const ctx = document.getElementById('trendChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#9ca3af', font: { size: 11 } }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: '#9ca3af', font: { size: 10 } },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            y: {
                                ticks: { color: '#9ca3af' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Failed to load trend chart:', error);
            }
        }

        // Fetch and render trending topics
        async function loadTrendingTopics() {
            try {
                const response = await fetch('/api/trending?limit=5');
                const data = await response.json();
                
                const container = document.getElementById('trending-topics');
                container.innerHTML = data.map(trend => {
                    const icon = trend.trend === 'up' ? 'üìà' : (trend.trend === 'down' ? 'üìâ' : '‚û°Ô∏è');
                    const color = trend.trend === 'up' ? 'text-green-400' : (trend.trend === 'down' ? 'text-red-400' : 'text-gray-400');
                    return `
                        <div class="flex items-center justify-between p-2 rounded hover:bg-white/5">
                            <span class="text-sm">${icon} ${trend.category}</span>
                            <span class="${color} text-sm font-medium">${trend.growth_percent > 0 ? '+' : ''}${trend.growth_percent}%</span>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to load trending topics:', error);
            }
        }

        // Generate briefing
        document.getElementById('generate-briefing').addEventListener('click', async function() {
            const btn = this;
            const loading = document.getElementById('briefing-loading');
            const content = document.getElementById('briefing-content');
            
            btn.disabled = true;
            btn.textContent = 'Generating...';
            loading.classList.add('active');
            content.style.display = 'none';
            
            try {
                const response = await fetch('/api/briefing/html?ai=false');
                const html = await response.text();
                
                content.innerHTML = html;
                content.style.display = 'block';
            } catch (error) {
                content.innerHTML = '<p class="text-red-400">Failed to generate briefing. Please try again.</p>';
                content.style.display = 'block';
            } finally {
                loading.classList.remove('active');
                btn.disabled = false;
                btn.textContent = 'Refresh Briefing';
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTrendChart();
            loadTrendingTopics();
        });
    </script>
</body>
</html>
