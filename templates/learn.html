<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn AI - AI Knowledge Base</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .module-card {
            transition: all 0.3s;
        }

        .module-card:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .progress-bar {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }

        .quiz-option {
            transition: all 0.2s;
        }

        .quiz-option:hover {
            background: rgba(99, 102, 241, 0.3);
        }

        .quiz-option.selected {
            background: rgba(99, 102, 241, 0.5);
            border-color: #6366f1;
        }

        .quiz-option.correct {
            background: rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }

        .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.3);
            border-color: #ef4444;
        }
    </style>
</head>

<body class="gradient-bg min-h-screen text-white">
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 backdrop-blur-lg bg-indigo-950/80 border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üìö</span>
                    <h1
                        class="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                        AI Learning Path
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/"
                        class="px-4 py-2 rounded-lg hover:bg-white/10 transition font-medium text-sm">Dashboard</a>
                    <a href="/search"
                        class="px-4 py-2 rounded-lg hover:bg-white/10 transition font-medium text-sm">Search</a>
                    <a href="/learn"
                        class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 transition font-medium text-sm">Learn</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Progress Summary -->
        <div id="progress-summary" class="card rounded-2xl p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold">Your Progress</h2>
                <span id="completion-badge" class="px-3 py-1 rounded-full bg-indigo-600/50 text-sm">Loading...</span>
            </div>
            <div class="w-full bg-white/10 rounded-full h-3 mb-2">
                <div id="progress-bar" class="progress-bar h-3 rounded-full transition-all" style="width: 0%"></div>
            </div>
            <p id="progress-text" class="text-sm text-gray-400"></p>
        </div>

        <!-- Curriculum View -->
        <div id="curriculum-view">
            <h2 class="text-xl font-semibold mb-6">Learning Modules</h2>
            <div id="modules-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Modules loaded dynamically -->
            </div>
        </div>

        <!-- Module Detail View (hidden by default) -->
        <div id="module-view" class="hidden">
            <button id="back-to-curriculum" class="flex items-center text-indigo-400 hover:text-indigo-300 mb-6">
                <span class="mr-2">‚Üê</span> Back to Curriculum
            </button>
            <div id="module-content"></div>
        </div>

        <!-- Quiz View (hidden by default) -->
        <div id="quiz-view" class="hidden">
            <div class="card rounded-2xl p-6">
                <h2 id="quiz-title" class="text-xl font-semibold mb-6">Quiz</h2>
                <div id="quiz-questions"></div>
                <div id="quiz-actions" class="mt-6 flex justify-end">
                    <button id="submit-quiz"
                        class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 rounded-lg font-medium transition">
                        Submit Answers
                    </button>
                </div>
                <div id="quiz-results" class="hidden mt-6"></div>
            </div>
        </div>
    </main>

    <script>
        let currentModule = null;
        let currentLesson = null;
        let quizAnswers = {};

        // Load curriculum on page load
        document.addEventListener('DOMContentLoaded', loadCurriculum);
        document.getElementById('back-to-curriculum').addEventListener('click', showCurriculum);
        document.getElementById('submit-quiz').addEventListener('click', submitQuiz);

        async function loadCurriculum() {
            try {
                const response = await fetch('/api/learn/curriculum');
                const data = await response.json();

                // Update progress
                const progress = data.progress;
                document.getElementById('progress-bar').style.width = `${progress.completion_percent}%`;
                document.getElementById('progress-text').textContent =
                    `${progress.completed_lessons} of ${progress.total_lessons} lessons completed`;
                document.getElementById('completion-badge').textContent = `${progress.completion_percent}%`;

                // Render modules
                const grid = document.getElementById('modules-grid');
                grid.innerHTML = data.modules.map((m, i) => `
                    <div class="module-card card rounded-xl p-6 cursor-pointer" onclick="loadModule(${m.id})">
                        <div class="flex items-start justify-between mb-3">
                            <span class="text-3xl">${getModuleIcon(i)}</span>
                            <span class="text-xs bg-white/10 px-2 py-1 rounded">${m.estimated_hours}h</span>
                        </div>
                        <h3 class="font-semibold mb-2">${m.title}</h3>
                        <p class="text-sm text-gray-400 mb-4">${m.description}</p>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-500">${m.lesson_count} lessons</span>
                            <span class="text-indigo-400">Start ‚Üí</span>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Failed to load curriculum:', error);
            }
        }

        function getModuleIcon(index) {
            const icons = ['ü§ñ', 'üíª', '‚úçÔ∏è', 'üîß', 'üé®', 'üìä'];
            return icons[index % icons.length];
        }

        async function loadModule(moduleId) {
            try {
                const response = await fetch(`/api/learn/modules/${moduleId}`);
                const module = await response.json();
                currentModule = module;

                document.getElementById('curriculum-view').classList.add('hidden');
                document.getElementById('module-view').classList.remove('hidden');

                document.getElementById('module-content').innerHTML = `
                    <div class="card rounded-2xl p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-2">${module.title}</h2>
                        <p class="text-gray-400 mb-4">${module.description}</p>
                        <div class="text-sm text-gray-500">‚è±Ô∏è Estimated: ${module.estimated_hours} hours</div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mb-4">Lessons</h3>
                    <div class="space-y-4">
                        ${module.lessons.map((lesson, i) => `
                            <div class="card rounded-xl p-4 flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-4 ${lesson.progress?.status === 'completed'
                        ? 'bg-green-600'
                        : 'bg-white/10'
                    }">
                                        ${lesson.progress?.status === 'completed' ? '‚úì' : i + 1}
                                    </div>
                                    <div>
                                        <h4 class="font-medium">${lesson.title}</h4>
                                        <p class="text-sm text-gray-400">${lesson.content?.substring(0, 100) || 'Explore this topic'}...</p>
                                    </div>
                                </div>
                                <button onclick="startQuiz(${lesson.id})" 
                                        class="px-4 py-2 rounded-lg ${lesson.progress?.status === 'completed'
                        ? 'bg-white/10 hover:bg-white/20'
                        : 'bg-indigo-600 hover:bg-indigo-500'
                    } transition text-sm">
                                    ${lesson.progress?.status === 'completed' ? 'Review' : 'Take Quiz'}
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load module:', error);
            }
        }

        function showCurriculum() {
            document.getElementById('module-view').classList.add('hidden');
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('curriculum-view').classList.remove('hidden');
            loadCurriculum();
        }

        async function startQuiz(lessonId) {
            try {
                currentLesson = lessonId;
                quizAnswers = {};

                const response = await fetch(`/api/learn/lessons/${lessonId}/quiz`);
                const data = await response.json();

                document.getElementById('module-view').classList.add('hidden');
                document.getElementById('quiz-view').classList.remove('hidden');
                document.getElementById('quiz-results').classList.add('hidden');
                document.getElementById('submit-quiz').classList.remove('hidden');

                document.getElementById('quiz-questions').innerHTML = data.questions.map((q, i) => `
                    <div class="mb-6 p-4 rounded-lg bg-white/5">
                        <p class="font-medium mb-4">${i + 1}. ${q.question}</p>
                        <div class="space-y-2">
                            ${q.options.map(opt => `
                                <div class="quiz-option p-3 rounded-lg border border-white/10 cursor-pointer"
                                     data-question="${q.id}" data-answer="${opt.charAt(0)}"
                                     onclick="selectAnswer(this, ${q.id}, '${opt.charAt(0)}')">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Failed to load quiz:', error);
            }
        }

        function selectAnswer(element, questionId, answer) {
            // Remove previous selection
            document.querySelectorAll(`[data-question="${questionId}"]`).forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            quizAnswers[questionId] = answer;
        }

        async function submitQuiz() {
            if (Object.keys(quizAnswers).length === 0) {
                alert('Please answer at least one question');
                return;
            }

            try {
                const response = await fetch(`/api/learn/lessons/${currentLesson}/quiz/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ answers: quizAnswers })
                });
                const result = await response.json();

                document.getElementById('submit-quiz').classList.add('hidden');

                // Show correct/incorrect styling
                result.feedback.forEach((f, i) => {
                    const options = document.querySelectorAll(`[data-question]`);
                    options.forEach(opt => {
                        if (opt.dataset.answer === f.correct_answer) {
                            opt.classList.add('correct');
                        } else if (opt.classList.contains('selected') && !f.is_correct) {
                            opt.classList.add('incorrect');
                        }
                    });
                });

                // Show results
                document.getElementById('quiz-results').innerHTML = `
                    <div class="p-6 rounded-xl ${result.passed ? 'bg-green-600/20 border border-green-500/30' : 'bg-red-600/20 border border-red-500/30'}">
                        <h3 class="text-xl font-bold mb-2">
                            ${result.passed ? 'üéâ Congratulations!' : 'üìö Keep Learning'}
                        </h3>
                        <p class="text-lg mb-4">Score: ${result.score}% (${result.correct}/${result.total})</p>
                        <div class="flex gap-4">
                            <button onclick="showCurriculum()" 
                                    class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition">
                                Back to Modules
                            </button>
                            ${!result.passed ? `
                                <button onclick="startQuiz(${currentLesson})" 
                                        class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg transition">
                                    Try Again
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                document.getElementById('quiz-results').classList.remove('hidden');

            } catch (error) {
                console.error('Failed to submit quiz:', error);
            }
        }
    </script>
</body>

</html>